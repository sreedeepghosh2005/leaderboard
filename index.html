<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Cloud Skills Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .rank-gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        .rank-silver {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            box-shadow: 0 4px 15px rgba(192, 192, 192, 0.3);
        }
        .rank-bronze {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            box-shadow: 0 4px 15px rgba(205, 127, 50, 0.3);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4285f4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8 fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">
                üèÜ Google Cloud Skills Leaderboard
            </h1>
            <p class="text-gray-600 text-lg">Track your progress and compete with peers</p>
            <p class="text-sm text-gray-500 mt-2" id="lastUpdate">Loading...</p>
        </header>

        <!-- Search Bar -->
        <div class="mb-6 fade-in">
            <div class="relative max-w-md mx-auto">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="üîç Search by name..." 
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-blue-500 focus:outline-none transition-colors shadow-sm"
                />
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="flex justify-center items-center py-20">
            <div class="loading-spinner"></div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 text-center">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard" class="hidden">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <!-- Desktop View -->
                <div class="hidden md:block">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-blue-600 to-blue-500 text-white">
                            <tr>
                                <th class="px-6 py-4 text-left font-semibold">Rank</th>
                                <th class="px-6 py-4 text-left font-semibold">Name</th>
                                <th class="px-6 py-4 text-center font-semibold">Skill Badges</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>

                <!-- Mobile View -->
                <div class="md:hidden" id="leaderboardMobile">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_KEY = "AIzaSyBscgVdttfCp4hpvqLgTYHmNCxHB83cRQQ";
        const SPREADSHEET_ID = "1UL2OK8oolWeehcs799ofOwxWciSJ5D0xyGuUxAhE1wI";
        const SHEET_NAME = " [06 Oct]";
        const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 minutes

        let allData = [];

        // Fetch data from Google Sheets
        async function fetchLeaderboardData() {
            const sheetNameEncoded = encodeURIComponent(SHEET_NAME);
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetNameEncoded}?key=${API_KEY}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.values;
            } catch (error) {
                console.error("Error fetching data:", error);
                throw error;
            }
        }

        // Process and sort data
        function processData(rawData) {
            if (!rawData || rawData.length < 2) return [];

            const headers = rawData[0];
            const nameIdx = headers.findIndex(h => h.toLowerCase().includes('name'));
            const badgesIdx = headers.findIndex(h => h.toLowerCase().includes('skill badges completed'));
            const urlIdx = headers.findIndex(h => h.toLowerCase().includes('profile url'));

            if (nameIdx === -1 || badgesIdx === -1) {
                console.error("Required columns not found");
                return [];
            }

            const processed = rawData.slice(1)
                .map(row => ({
                    name: row[nameIdx] || '',
                    badges: parseInt(row[badgesIdx]) || 0,
                    url: row[urlIdx] || '#'
                }))
                .filter(item => item.name && item.badges > 0)
                .sort((a, b) => b.badges - a.badges);

            return processed;
        }

        // Get rank class
        function getRankClass(rank) {
            if (rank === 1) return 'rank-gold';
            if (rank === 2) return 'rank-silver';
            if (rank === 3) return 'rank-bronze';
            return '';
        }

        // Get rank emoji
        function getRankEmoji(rank) {
            if (rank === 1) return 'ü•á';
            if (rank === 2) return 'ü•à';
            if (rank === 3) return 'ü•â';
            return rank;
        }

        // Render leaderboard
        function renderLeaderboard(data) {
            const tbody = document.getElementById('leaderboardBody');
            const mobileContainer = document.getElementById('leaderboardMobile');
            tbody.innerHTML = '';
            mobileContainer.innerHTML = '';

            data.forEach((item, index) => {
                const rank = index + 1;
                const rankClass = getRankClass(rank);
                const rankDisplay = getRankEmoji(rank);

                // Desktop row
                const row = document.createElement('tr');
                row.className = `hover:bg-gray-50 transition-colors ${rankClass}`;
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <span class="text-2xl font-bold">${rankDisplay}</span>
                    </td>
                    <td class="px-6 py-4">
                        <a href="${item.url}" target="_blank" rel="noopener noreferrer" 
                           class="text-blue-600 hover:text-blue-800 hover:underline font-medium">
                            ${item.name}
                        </a>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                            ${item.badges} badges
                        </span>
                    </td>
                `;
                tbody.appendChild(row);

                // Mobile card
                const card = document.createElement('div');
                card.className = `p-4 border-b border-gray-200 ${rankClass}`;
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl font-bold">${rankDisplay}</span>
                            <div>
                                <a href="${item.url}" target="_blank" rel="noopener noreferrer" 
                                   class="text-blue-600 hover:text-blue-800 hover:underline font-medium block">
                                    ${item.name}
                                </a>
                            </div>
                        </div>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                            ${item.badges}
                        </span>
                    </div>
                `;
                mobileContainer.appendChild(card);
            });

            document.getElementById('leaderboard').classList.remove('hidden');
            document.getElementById('loadingSpinner').classList.add('hidden');
        }

        // Search functionality
        function filterLeaderboard() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allData.filter(item => 
                item.name.toLowerCase().includes(searchTerm)
            );
            renderLeaderboard(filtered);
        }

        // Show error
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('loadingSpinner').classList.add('hidden');
        }

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('lastUpdate').textContent = `Last updated: ${timeStr}`;
        }

        // Load leaderboard
        async function loadLeaderboard() {
            try {
                document.getElementById('errorMessage').classList.add('hidden');
                const rawData = await fetchLeaderboardData();
                allData = processData(rawData);
                
                if (allData.length === 0) {
                    showError("No valid data found in the spreadsheet");
                    return;
                }

                renderLeaderboard(allData);
                updateTimestamp();
            } catch (error) {
                showError("Failed to load leaderboard data. Please check the API key and spreadsheet permissions.");
                console.error(error);
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterLeaderboard);

        // Initial load
        loadLeaderboard();

        // Auto-refresh every 5 minutes
        setInterval(loadLeaderboard, REFRESH_INTERVAL);
    </script>
</body>
</html>